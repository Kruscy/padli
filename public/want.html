<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Want To Read</title>
<link rel="stylesheet" href="/css/sidebar.css">
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/grid.css">
<link rel="stylesheet" href="/css/header.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">

</head>
<body>

<header class="topbar">
  <button id="menuToggle" class="menu-btn">â˜°</button>
 
    <a href="/" class="logo">
    <img src="/assets/logo.png" alt="PadlizsanFanSub">
    <span>PadlizsanFanSub</span>
  </a>

  <div class="search-wrapper">
    <input
      type="text"
      id="searchInput"
      placeholder="Search manga..."
      autocomplete="off"
    />
    <div id="searchResults" class="search-results hidden"></div>
  </div>
<a
  href="https://patreon.com/Padlizsanfansub"
  target="_blank"
  class="patreon"
  title="Support us on Patreon"
>
  <img src="/assets/pat2.png" alt="Patreon">
</a>
<button id="logoutBtn" class="icon-btn" title="Logout">
  <img src="/assets/logout.png" alt="Logout">
</button>

<script>
document.getElementById("logoutBtn")?.addEventListener("click", async () => {
  await fetch("/api/auth/logout", { method: "POST" });
  location.href = "/login.html";
});
</script>

</header>
<!-- SIDEBAR -->
<aside id="sidebar" class="sidebar">
  <nav>
    <a href="/">ğŸ  Home</a>
    <a href="/want.html">â­ Want To Read</a>
    <a href="/collections.html">ğŸ“š Collections</a>
    <a href="/bookmarks.html">ğŸ”– Bookmarks</a>
    <hr>

    <a href="/partners.html">ğŸ¤ TÃ¡rsoldalak</a>
  </nav>
</aside>

<!-- OVERLAY -->
<div id="overlay" class="overlay"></div>

<main class="content">
  <h1>â­ Want To Read</h1>
  <div id="grid"></div>
</main>

<script src="/js/auth-check.js"></script>

<script>
(async () => {
  const res = await fetch("/api/want");
  const mangas = await res.json();

  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  mangas.forEach(m => {
    const a = document.createElement("a");
    a.className = "card";
    a.href = `/chapters.html?slug=${m.slug}`;

    const img = document.createElement("img");
    img.src = m.cover_url || "/assets/no-cover.png";

    const t = document.createElement("div");
    t.className = "title";
    t.textContent = m.title;

    a.append(img, t);
    grid.appendChild(a);
  });
})();
</script>


<script>
let allManga = [];

fetch("/api/manga")
  .then(r => r.json())
  .then(data => {
    allManga = data;
  });

const input = document.getElementById("searchInput");
const results = document.getElementById("searchResults");

input.addEventListener("input", () => {
  const q = input.value.toLowerCase().trim();
  results.innerHTML = "";

  if (!q) {
    results.classList.add("hidden");
    return;
  }

  const matches = allManga
    .filter(m => m.title.toLowerCase().includes(q))
    .slice(0, 10);

  if (!matches.length) {
    results.classList.add("hidden");
    return;
  }

  matches.forEach(m => {
    const div = document.createElement("div");
    div.className = "search-item";

    div.innerHTML = `
      <img src="${m.cover_url || "/assets/no-cover.png"}">
      <span>${m.title}</span>
    `;

    div.onclick = () => {
      window.location.href = `/chapters.html?slug=${m.slug}`;
    };

    results.appendChild(div);
  });

  results.classList.remove("hidden");
});

// kattint  s m  shova  ^f^r bez  r
document.addEventListener("click", e => {
  if (!e.target.closest(".search-wrapper")) {
    results.classList.add("hidden");
  }
});
</script>
<script src="/js/sidebar.js"></script>
</body>
</html>
