<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>PadlizsanFanSub</title>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/header.css">
<link rel="stylesheet" href="/css/grid.css">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header class="topbar">
  <a href="/" class="logo">
    <img src="/assets/logo.png" alt="PadlizsanFanSub">
    <span>PadlizsanFanSub</span>
  </a>

  <div class="search-wrapper">
    <input
      type="text"
      id="searchInput"
      placeholder="Search manga..."
      autocomplete="off"
    />
    <div id="searchResults" class="search-results hidden"></div>
  </div>
<a
  href="https://patreon.com/Padlizsanfansub"
  target="_blank"
  class="patreon"
  title="Support us on Patreon"
>
  <img src="/assets/patlogo.png" alt="Patreon">
</a>
</header>

<!-- EZ A FONTOS: IDE RAJZOL A JS -->
<div id="grid"></div>

<script>
(async function () {
  try {
    const res = await fetch("/api/manga");
    const data = await res.json();

    const grid = document.getElementById("grid");
    grid.innerHTML = "";

    data.forEach(m => {
      const a = document.createElement("a");
      a.className = "card";
      a.href = `/chapters.html?slug=${encodeURIComponent(m.slug)}`;
      a.title = m.title;

      const cover = document.createElement("div");
      cover.className = "cover";

      if (m.cover_url) {
        const img = document.createElement("img");
        img.src = m.cover_url;
        img.loading = "lazy";
        cover.appendChild(img);
      } else {
        cover.textContent = "No Cover";
      }

      const title = document.createElement("div");
      title.className = "title";
      title.textContent = m.title;

      a.appendChild(cover);
      a.appendChild(title);
      grid.appendChild(a);
    });

  } catch (e) {
    console.error("Failed to load manga", e);
  }
})();
</script>
<script>
let allManga = [];

fetch("/api/manga")
  .then(r => r.json())
  .then(data => {
    allManga = data;
  });

const input = document.getElementById("searchInput");
const results = document.getElementById("searchResults");

input.addEventListener("input", () => {
  const q = input.value.toLowerCase().trim();
  results.innerHTML = "";

  if (!q) {
    results.classList.add("hidden");
    return;
  }

  const matches = allManga
    .filter(m => m.title.toLowerCase().includes(q))
    .slice(0, 10);

  if (!matches.length) {
    results.classList.add("hidden");
    return;
  }

  matches.forEach(m => {
    const div = document.createElement("div");
    div.className = "search-item";

    div.innerHTML = `
      <img src="${m.cover_url || "/assets/no-cover.png"}">
      <span>${m.title}</span>
    `;

    div.onclick = () => {
      window.location.href = `/chapters.html?slug=${m.slug}`;
    };

    results.appendChild(div);
  });

  results.classList.remove("hidden");
});

// kattint  s m  shova  ^f^r bez  r
document.addEventListener("click", e => {
  if (!e.target.closest(".search-wrapper")) {
    results.classList.add("hidden");
  }
});
</script>

</body>
</html>
